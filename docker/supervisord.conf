[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisor/supervisord.pid

[program:redis]
command=redis-server --appendonly yes --bind 127.0.0.1 --dir /var/lib/redis
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/redis.err.log
stdout_logfile=/var/log/supervisor/redis.out.log
user=appuser
priority=10

[program:fastapi]
command=uv run uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
directory=/app
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=/var/log/supervisor/fastapi.err.log
stdout_logfile=/var/log/supervisor/fastapi.out.log
user=appuser
priority=20
environment=REDIS_HOST="127.0.0.1",REDIS_PORT="6379",REDIS_DB="0"

[program:arq-worker]
command=uv run arq src.workers.workers.WorkerSettings
directory=/app
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=/var/log/supervisor/arq.err.log
stdout_logfile=/var/log/supervisor/arq.out.log
user=appuser
priority=30
environment=REDIS_HOST="127.0.0.1",REDIS_PORT="6379",REDIS_DB="0"

