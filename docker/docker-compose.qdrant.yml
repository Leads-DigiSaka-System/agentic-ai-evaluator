# Docker Compose configuration for Qdrant Vector Database
#
# USAGE:
#   Start Qdrant:
#     docker compose -f docker-compose.qdrant.yml up -d
#
#   Stop Qdrant:
#     docker compose -f docker-compose.qdrant.yml down
#
#   View logs:
#     docker compose -f docker-compose.qdrant.yml logs -f
#
#   Verify it's running:
#     curl http://localhost:6333/
#
#   Access Web UI:
#     http://localhost:6333/dashboard
#
#   Remove container and volumes (CAUTION: deletes data):
#     docker compose -f docker-compose.qdrant.yml down -v

version: "3.9"

services:
  qdrant:
    # Option 1: Use official Qdrant image (recommended for quick start)
    image: qdrant/qdrant:latest
    
    # Option 2: Use custom built image (uncomment below and comment above)
    # build:
    #   context: .
    #   dockerfile: Dockerfile.qdrant
    # image: qdrant-custom:latest
    
    container_name: qdrant
    restart: unless-stopped
    
    ports:
      - "6333:6333"  # HTTP API
      - "6334:6334"  # gRPC API
    
    volumes:
      # Persistent storage for Qdrant data
      - qdrant_storage:/qdrant/storage
      
      # Optional: Mount a custom config file (uncomment if needed)
      # - ./qdrant.config.yaml:/qdrant/config/production.yaml:ro
    
    environment:
      # Optional: Set Qdrant configuration via environment variables
      # See https://qdrant.tech/documentation/guides/configuration/
      # - QDRANT__LOG_LEVEL=INFO
      # - QDRANT__SERVICE__HTTP_PORT=6333
      # - QDRANT__SERVICE__GRPC_PORT=6334
    
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:6333/"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 10s
    
    networks:
      - qdrant_network

volumes:
  qdrant_storage:
    driver: local
    # Uncomment to use a specific path on the host (useful for backups)
    # driver_opts:
    #   type: none
    #   o: bind
    #   device: ./qdrant_data

networks:
  qdrant_network:
    driver: bridge

